<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tree Arithmetic with Phylogenetic Flows • phyf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tree Arithmetic with Phylogenetic Flows">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phyf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/phyf.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/phyf_arith.html">Tree Arithmetic with Phylogenetic Flows</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://rdinnager.github.io/pulling_threads/" aria-label="Blog">Blog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tree Arithmetic with Phylogenetic Flows</h1>
            
      

      <div class="d-none name"><code>phyf_arith.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rdinnager.github.io/phyf/">phyf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'phyf'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     pf</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://withr.r-lib.org" class="external-link">withr</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette we will see how the <a href="https://rdinnager.github.io/phyf/">phyf</a> package
makes it easy to manipulate phylogenetic tree by performing arithmetic
on phylogenetic flow collection objects (<code>pfc</code>). A
phylogenetic flow collection is a way to represent a rooted phylogenetic
as a set of ‘flows’ from the root of the tree to its terminal nodes
(e.g. the tree’s tips). Each edge between the root and the tips can have
data associated with it, which we call phylogenetic flow features
(<code>pff</code>). Often these feature will be the branch length
associated with the edge. We can perform arithmetic on these features to
do lots of interesting and useful thing. In this vignette, we will focus
on using <code>pfc</code> arithmetic to perform the classic branch
length transformations known as Pagel’s transformations. There are
three: ‘lambda’, ‘delta’, and ‘kappa’.</p>
<div class="section level2">
<h2 id="pagels-kappa">Pagel’s Kappa<a class="anchor" aria-label="anchor" href="#pagels-kappa"></a>
</h2>
<p>We will start with the kappa transformation because it is the
simplest one from the perspective of a phylogenetic flow. It is simply
raising the branch lengths of a phylogenetic tree to some power (which
is the kappa parameter). Typically, kappa values less than one are used,
but values greater than one are also possible. Kappa values less than
one tend to ‘shrink’ branch lengths non-linearly towards 1, until we
have at kappa = 0, all branch lengths are exactly one. This is sometimes
used to model ‘speciational’ change along branches, because any model
weighted by the branch lengths will be insensitive to branch length,
only the branching structure itself. First we start by generating a
random tree using <code>ape</code>, converting that to a
<code>pfc</code>. Then we demonstrate the transformation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3445564</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html" class="external-link">rcoal</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">tree_pfc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_as_pfc.html">pf_as_pfc</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree_pfc</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyf_arith_files/figure-html/generate-1.png" width="700"></p>
<p>When we create a <code>pfc</code> object from a <code>phylo</code>
object, the branch lengths of the tree are automatically used as the
phylogenetic flow feature. We can easily perform a kappa transformation
by directly raising the <code>pfc</code> object to the desired kappa
parameter. Let’s test it with kappa = 0.5</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_pfc_0.5</span> <span class="op">&lt;-</span> <span class="va">tree_pfc</span><span class="op">^</span><span class="fl">0.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree_pfc_0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyf_arith_files/figure-html/kappa_0.5-1.png" width="700"></p>
<p>We can see as a result of the transformation that longer branches
have become relatively shorter compared with branches that started out
shorter. We can do a series of transformation to see how the tree
converges to kappa = 0.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://withr.r-lib.org/reference/with_par.html" class="external-link">with_par</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, xpd <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, length.out <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree_pfc</span><span class="op">^</span><span class="va">i</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"kappa = %s"</span>, <span class="va">i</span><span class="op">)</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyf_arith_files/figure-html/kappa_all-1.png" width="700"></p>
<p>Pagel’s lambda and delta transformations are a little more
complicated but still pretty easy to calculate in
<a href="https://rdinnager.github.io/phyf/">phyf</a>.</p>
</div>
<div class="section level2">
<h2 id="pagels-lambda">Pagel’s Lambda<a class="anchor" aria-label="anchor" href="#pagels-lambda"></a>
</h2>
<p>Pagel’s lambda transformation multiplies the internal branch lengths
by a constant (the lambda parameter), whilst compensatorily growing the
terminal branches to keep the total distances from the root to the tips
the same. Again, lambda is usually set to less than 1, such that as
lambda goes to zero the internal branches shrink to nothing, leaving
only the terminla branches. This model is derived by transforming the
phylogenetic variance-covariance matrix implied by a phylogeny. Lambda
&gt; 1 is not usually used because the resulting variance-covariance
matrix can become ill-conditioned. From the perspective of branch length
transformation this is because if you multiply an internal branch by two
much greater than zero, its height can become greater than the height of
the tips, and so you cannot maintain the total distance from the root to
tips without negative branch lengths!</p>
<p>So to do the transformation in <a href="https://rdinnager.github.io/phyf/">phyf</a> we need to do two
transformations, one on the internal branches and one on the external
branches. We also need information on the root to tips lengths, which is
the sum of each phylogenetic flow feature.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">lambda_pfc</span> <span class="op">&lt;-</span> <span class="va">tree_pfc</span></span>
<span><span class="va">root2node_lens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_flow_sum.html">pf_flow_sum</a></span><span class="op">(</span><span class="va">lambda_pfc</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/pf_internal.html">pf_internal</a></span><span class="op">(</span><span class="va">lambda_pfc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_internal.html">pf_internal</a></span><span class="op">(</span><span class="va">lambda_pfc</span><span class="op">)</span> <span class="op">*</span> <span class="va">lambda</span></span>
<span><span class="fu"><a href="../reference/pf_internal.html">pf_terminal</a></span><span class="op">(</span><span class="va">lambda_pfc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_internal.html">pf_terminal</a></span><span class="op">(</span><span class="va">lambda_pfc</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">root2node_lens</span> <span class="op">-</span> <span class="fu"><a href="../reference/pf_flow_sum.html">pf_flow_sum</a></span><span class="op">(</span><span class="va">lambda_pfc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lambda_pfc</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyf_arith_files/figure-html/lambda-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda_trans</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">lambda</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">root2node_lens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_flow_sum.html">pf_flow_sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/pf_internal.html">pf_internal</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_internal.html">pf_internal</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">lambda</span></span>
<span>  <span class="fu"><a href="../reference/pf_internal.html">pf_terminal</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_internal.html">pf_terminal</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">root2node_lens</span> <span class="op">-</span> <span class="fu"><a href="../reference/pf_flow_sum.html">pf_flow_sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://withr.r-lib.org/reference/with_par.html" class="external-link">with_par</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, xpd <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, length.out <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">lambda_trans</span><span class="op">(</span><span class="va">tree_pfc</span>, <span class="va">i</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"f"</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"lambda = %s"</span>, <span class="va">i</span><span class="op">)</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyf_arith_files/figure-html/lambda_series-1.png" width="700">
## Pagel’s Delta</p>
<p>Lastly, Pagel’s delta transformation is a transformation of the node
heights of a phylogeny, raising each to the power of the delta
parameter. This has the effect of shrinking branches near the tips more
than those near the root. In the context of a model of evolution on the
tree, this is used to model a ‘slow-down’ of evolution through time. We
can acheive this transformation by first generating a <code>pfc</code>
where the node heights are the phylogenetic flow features instead of the
branch lengths. Node heights can be calculated as the cumulative sum of
branch lengths down each phylogenetic flow. <a href="https://rdinnager.github.io/phyf/">phyf</a> has the
<code><a href="../reference/pf_flow_cumsum.html">pf_flow_cumsum()</a></code> function for this.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">node_heights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_flow_cumsum.html">pf_flow_cumsum</a></span><span class="op">(</span><span class="va">tree_pfc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">node_heights</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;pfc&lt;e:198&gt;[6]&gt;</span></span>
<span><span class="co">#&gt; First  6 phylogenetic flows: </span></span>
<span><span class="co">#&gt; [1] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #5F0087;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.8</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t24</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [2] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #5F0087;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node46</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.8</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t13</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [3] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #5F0087;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node46</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.8</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node58</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.8</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t7</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [4] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #5F0087;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node46</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.8</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node58</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.8</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t40</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [5] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #5F0087;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node39</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.8</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t48</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [6] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #5F0087;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #87D787;">  1.6</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #D7FF00;">  1.7</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node39</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.8</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t81</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">node_heights</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyf_arith_files/figure-html/node_heights-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span>
<span><span class="va">new_pfc</span> <span class="op">&lt;-</span> <span class="va">node_heights</span><span class="op">^</span><span class="va">delta</span></span></code></pre></div>
<p>Now to get back branch lengths instead of node heights all we need to
do is subtract from each node height the node height of its immediate
ancestor. <a href="https://rdinnager.github.io/phyf/">phyf</a> also has a convenient function for this:
<code><a href="../reference/pf_anc.html">pf_anc()</a></code>, which returns a <code>pfc</code> with each
feature replaces by the feature value of its ancestor.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/pf_anc.html">pf_anc</a></span><span class="op">(</span><span class="va">new_pfc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;pfc&lt;e:198&gt;[6]&gt;</span></span>
<span><span class="co">#&gt; First  6 phylogenetic flows: </span></span>
<span><span class="co">#&gt; [1] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  0.0</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t24</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [2] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  0.0</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node46</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t13</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [3] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  0.0</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node46</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node58</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.3</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t7</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [4] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  0.0</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node46</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node58</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.3</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t40</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [5] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  0.0</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node39</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t48</span> </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [6] <span style="color: #BB0000;">◎──</span><span style="color: #BBBBBB; background-color: #5F005F;">  0.0</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node3</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node4</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #AFFF5F;">  1.1</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node10</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node11</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node23</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="color: #0000BB; font-weight: bold;">Node39</span> <span style="color: #BB0000;">──</span><span style="color: #BBBBBB; background-color: #FFFF00;">  1.2</span><span style="color: #BB0000;">──→</span> <span style="background-color: #BBBBBB; font-weight: bold; font-style: italic;">t81</span></span></span>
<span><span class="va">new_pfc</span> <span class="op">&lt;-</span> <span class="va">new_pfc</span> <span class="op">-</span> <span class="fu"><a href="../reference/pf_anc.html">pf_anc</a></span><span class="op">(</span><span class="va">new_pfc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">new_pfc</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyf_arith_files/figure-html/anc-1.png" width="700"></p>
<p>A series of deltas:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delta_trans</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">delta</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">new_pfc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pf_flow_cumsum.html">pf_flow_cumsum</a></span><span class="op">(</span><span class="va">tree_pfc</span><span class="op">)</span><span class="op">^</span><span class="va">delta</span></span>
<span>  <span class="va">new_pfc</span> <span class="op">&lt;-</span> <span class="va">new_pfc</span> <span class="op">-</span> <span class="fu"><a href="../reference/pf_anc.html">pf_anc</a></span><span class="op">(</span><span class="va">new_pfc</span><span class="op">)</span></span>
<span>  <span class="va">new_pfc</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://withr.r-lib.org/reference/with_par.html" class="external-link">with_par</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, xpd <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">delta_trans</span><span class="op">(</span><span class="va">tree_pfc</span>, <span class="va">i</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"f"</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"delta = %s"</span>, <span class="va">i</span><span class="op">)</span>, show.tip.label <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="phyf_arith_files/figure-html/delta_series-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Russell Dinnage.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
